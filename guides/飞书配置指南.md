# 飞书配置指南

## 一、创建飞书应用

1. 访问 [飞书开放平台](https://open.feishu.cn/)，登录后点击「创建应用」
2. 选择「自建应用」，填写应用名称（如"GEO 助手"）
3. 记录 **App ID** 和 **App Secret**

## 二、配置机器人

1. 在应用详情页，点击「添加应用能力」→「机器人」
2. 设置机器人名称和头像
3. 开启「接收消息」能力

## 三、配置消息订阅

1. 在「事件订阅」页面，添加以下事件：
   - `im.message.receive_v1`（接收消息）
2. 设置「请求地址」为你的服务器地址（如 `https://your-server.com/webhook`）

## 四、部署机器人代码

### 方式 1：本地运行（测试用）

```bash
cd geo_business_tool/scripts
pip install flask openai requests
python feishu_bot.py
```

使用 ngrok 暴露本地端口：
```bash
ngrok http 8080
```

将 ngrok 生成的 URL 填入飞书「请求地址」。

### 方式 2：云函数部署（生产用）

1. 在阿里云/腾讯云创建云函数
2. 上传 `feishu_bot.py` 和 `config.py`
3. 配置环境变量：`OPENAI_API_KEY`、`FEISHU_APP_ID`、`FEISHU_APP_SECRET`
4. 设置 HTTP 触发器，获取公网 URL
5. 将 URL 填入飞书「请求地址」

## 五、发布应用

1. 在「版本管理与发布」页面，创建新版本
2. 提交审核并发布
3. 在企业内部群聊中 @机器人，即可使用

## 六、使用方法

在飞书群聊中发送以下命令：

| 命令 | 说明 |
|------|------|
| `@GEO助手 跑D 品牌A` | 执行语义矩阵提取 |
| `@GEO助手 跑B 品牌A` | 执行转化路径优化 |
| `@GEO助手 跑C [内容]` | 执行内容审计打分 |
| `@GEO助手 跑A 品牌A` | 生成商业提案 |

## 七、进阶配置

### 对接飞书多维表格

1. 创建多维表格，包含「客户输入卡」「项目进度」等表
2. 在机器人代码中添加读取多维表格的逻辑
3. 当用户发送 `跑D 品牌A` 时，自动从多维表格读取品牌A的输入卡

### 权限分级

1. 在飞书后台创建不同权限组
2. 新员工：只能执行 D
3. 老员工：可执行 D/B/C
4. 管理员：可执行 A + 查看完整 Prompt
